# Crustecan Warrior API Design

Fixture list and user based ticketing system for football club Crustecan Warrior.

### Specification: REST

_Note: This documentation may not be accurate and will be updated over time._

## Fixtures

### **Data Structure**

```js
{
  _id: String, // MongoDB ObjectId.
  homeTeam: String,
  awayTeam: String,
  event: String,
  date: Date, // Date string.
  isHome: Boolean,
  seats: [
    {
      section: String,
      seatNumber: String,
      isAvailable: Boolean,
    }
  ],
  isTicketAvailable: Boolean, // State changes occur on each successful checkout in order to avoid seats array checking on each query.
}
```

#### Example:

```js
{
  _id: 'abcdefghjijkl',
  homeTeam: 'Crustecan Warrior',
  awayTeam: 'Fluorascent FC',
  event: 'Premier League',
  date: '2021-11-19T09:59:53.470Z', // Date string.
  isHome: true,
  seats: [
    {
      section: 'A',
      seatNumber: '001-0100',
      isAvailable: true
    },
    {
      section: 'A',
      seatNumber: '001-0101',
      isAvailable: false,
    }
  ],
  isTicketAvailable: true,
}
```

### **List All Fixtures**

List all fixtures. Default to the next fixtures ranging to three months ahead.

### Endpoint

```
GET /api/fixture
```

### Parameters

- `increment` **Required**  
  Type: `Number`  
  Default: 1  
  Current data incrementation. Each call will return 3 fixtures by default and will increment based on that limits.
- `includeSeat` _Optional_  
  Type: `Boolean`  
  Default: false  
  By default, fixture list calls will not include seating information to reduce request load. A call with `includeSeat` set to `true` will occur on ticket fixtures instead.

### Returns

An array of fixtures starting from the next unplayed fixture until the next three matches.

It will use a "Load More" function rather than the usual pagination. Therefore, it will result in a continuous and chunked response data instead of a full fixture list on each request.

### Response Example

```js
{
  increment: 1,
  length: 3,
  fixtures: [
    {
      _id: 'abcdefghjijkl',
      homeTeam: 'Crustecan Warrior',
      awayTeam: 'Fluorascent FC',
      event: 'Premier League',
      date: '2021-11-19T09:59:53.470Z', // Date string.
      isHome: true,
      seats: [
        {
          section: 'A',
          seatNumber: '001-0100',
          isBooked: true
        },
        {
          section: 'A',
          seatNumber: '001-0101',
          isBooked: false,
        }
      ],
      isTicketAvailable: true,
    },
    // other fixtures...
  ]
}
```

### **Get Fixture Details**

Gets a fixture's details based on its ID.

### Endpoint

```
GET /api/fixture/:id
```

### Parameters

- `includeSeat` _Optional_  
  Type: `Boolean`  
  Default: false  
  Whether or not to include seating information too.

### Returns

A fixture's detailed information.

### Response Example

```js
{
  fixture: {
    _id: 'abcdefghjijkl',
    homeTeam: 'Crustecan Warrior',
    awayTeam: 'Fluorascent FC',
    event: 'Premier League',
    date: '2021-11-19T09:59:53.470Z', // Date string.
    isHome: true,
    isTicketAvailable: true,
  },
},
```

---

## Ticket

### Data Structure

```js
{
  _id: String, // MongoDB ObjectId.
  fixture: Object, // Reference to fixtur data.
  seat: {
    section: String,
    seatNumber: String,
  },
}
```

#### Example:

```js
{
  _id: 'abcdefghijkl',
  fixture: 'mnopqrstuvwxyz',
  seat: {
    section: 'A',
    seatNumber: '001-0100',
  },
}
```

### **Create Checkout Session**

Create checkout session powered by Stripe to get URL to payment page. While the payment session is still active (it's neither succeed or failed), the ordered seat status will not be available for other session. User will be given 15 minutes to complete the order, else it will be canceled automatically.

### Endpoint

```
POST /api/ticket/create-checkout-session
```

### Parameters

_No parameters._

### Body Data

Type: JSON

- `fixtureId` **Required**  
  Type: `String`  
  Default: ''  
  Fixture's ID.
- `orders` **Required**  
  Type: `Object`  
  Default: null  
  An array of seat orders object.
  - `section` **Required**  
    Type: String  
    Default: ''  
    Seat section.
  - `seatNumber` **Required**  
    Type: String  
    Default: ''  
    Seat number.

### Returns

Redirect URL to Stripe checkout page.

### Response Example

```js
{
  url: 'http://stripe.com/checkout' // URL will be generated by Stripe.
},
```

---

## Transaction

Transaction data to monitor all initiated checkouts, its status, and act as a general log book.

### Data Structure

```js
{
  _id: String,
  transactionId: String, // Stripe payment session ID.
  fixture: Object,
  seat: Object,
  status: Array, // An array of statuses. The last entry will be the latest update.
}
```

#### Example:

```js
{
  _id: 'abcdefghijkl',
  fixture: 'mnopqrstuvwxyz',
  seat: {
    section: 'A',
    seatNumber: '001-0100',
  },
  status: [
    'Payment intent created.',
    'Payment is pending.',
    'Payment has completed.',
  ],
}
```

---

## User Management

User accounts management using Passport local strategy (username and password) and maintains login state as sessions.

### **Register**

Register a new user.

### Endpoint

```
POST /api/user/register
```

### Parameters

No parameters.

### Body Data

Type: JSON

- `username` **Required**  
  Type: `String`  
  Default: ''  
  User's username. Used as one of the login credentials.
- `password` **Required**  
  Type: `String`  
  Default: ''  
  User's password.
- `email` **Required**  
  Type: String  
  Default: ''  
  User's email.
- `name` **Required**  
  Type: String  
  Default: ''  
  User's full name.

### Returns

User's username.

```js
{
  success: true,
  user: {
    username: 'bigjoe'
  }
},
```

### **Login**

User login.

### Endpoint

```
POST /api/user/login
```

### Parameters

No parameters.

### Body Data

Type: JSON

- `username` **Required**  
  Type: `String`  
  Default: ''  
  User's username. Used as one of the login credentials.
- `password` **Required**  
  Type: `String`  
  Default: ''  
  User's password.

### Returns

User's username.

```js
{
  success: true,
  user: {
    username: 'bigjoe'
  }
},
```

### **Logout**

User logout.

### Endpoint

```
GET /api/user/logout
```

### Parameters

No parameters.

### Body Data

No body data.

### Returns

None.

```js
{ success: true },
```
