# Crustecan Warrior API Design

Fixture list and user based ticketing system for football club Crustecan Warrior.

### Specification: REST

_Note: This documentation will be updated over time._

## Fixtures

### **Data Structure**

```js
{
  _id: String, // MongoDB ObjectId.
  homeTeam: String,
  awayTeam: String,
  event: String,
  date: Date, // Date string.
  isHome: Boolean,
  seats: [
    {
      section: String,
      seatNumber: String,
      isBooked: Boolean,
      ticket: Object, // Reference to Ticket instance.
    }
  ],
  isTicketAvailable: Boolean, // State changes occur on each successful checkout in order to avoid seats array checking on each query.
}
```

#### Example:

```js
{
  _id: 'abcdefghjijkl',
  homeTeam: 'Crustecan Warrior',
  awayTeam: 'Fluorascent FC',
  event: 'Premier League',
  date: '2021-11-19T09:59:53.470Z', // Date string.
  isHome: true,
  seats: [
    {
      section: 'A',
      seatNumber: '001-0100',
      isBooked: true,
      ticket: 'abcdefghjijkl', // Ticket ID.
    },
    {
      section: 'A',
      seatNumber: '001-0101',
      isBooked: false,
      ticket: null,
    }
  ],
  isTicketAvailable: true,
}
```

### **List All Fixtures**

List all fixtures. Default to the next fixtures ranging to three months ahead.

### Endpoint

```
GET /api/fixture
```

### Parameters

- `page` **Required**  
  Type: `Number`  
  Default: 1  
  Current page iteration.
- `includeSeat` _Optional_  
  Type: `Boolean`  
  Default: false  
  By default, fixture list calls will not include seating information to reduce request load. A call with `includeSeat` set to `true` will occur on ticket fixtures instead.

### Returns

An array of fixtures starting from the next unplayed fixture until the next three months schedule.

It will use a "Load More" function rather than the usual pagination. Therefore, it will result in a continuous and chunked response data instead of a full fixture list on each request.

### Response Example

```js
{
  page: 1,
  fixtures: [
    {
      _id: 'abcdefghjijkl',
      homeTeam: 'Crustecan Warrior',
      awayTeam: 'Fluorascent FC',
      event: 'Premier League',
      date: '2021-11-19T09:59:53.470Z', // Date string.
      isHome: true,
      seats: {
        'A': [
          {
            seatNumber: '001-0100',
            isBooked: true,
            ticket: 'abcdefghjijkl', // Ticket ID.
          },
          {
            seatNumber: '001-0101',
            isBooked: false,
            ticket: null,
          }
        ]
      },
      isTicketAvailable: true,
    },
    // other fixtures...
  ]
}
```

### **Get Fixture Details**

Gets a fixture's details based on its ID.

### Endpoint

```
GET /api/fixture/:id
```

### Parameters

- `includeSeat` _Optional_  
  Type: `Boolean`  
  Default: false  
  Whether or not to include seating information too.

### Returns

A fixture's detailed information.

### Response Example

```js
{
  fixture: {
    _id: 'abcdefghjijkl',
    homeTeam: 'Crustecan Warrior',
    awayTeam: 'Fluorascent FC',
    event: 'Premier League',
    date: '2021-11-19T09:59:53.470Z', // Date string.
    isHome: true,
    isTicketAvailable: true,
  },
},
```

<!-- ---

## Seat

### Data Structure

```js
{
  _id: String,
  section: String,
  seatNumber: String,
  bookingStatus: Boolean,
}
```

#### Example:

```js
{
  _id: 'abcdefghijkl',
  section: 'A',
  seatNumber: '001-0100',
  bookingStatus: true,
}
``` -->

---

## Ticket

### Data Structure

```js
{
  _id: String, // MongoDB ObjectId.
  fixture: Object, // Reference to fixtur data.
  seat: {
    section: 'A',
    seatNumber: '001-0100',
  },
}
```

#### Example:

```js
{
  _id: 'abcdefghijkl',
  fixture: 'mnopqrstuvwxyz',
  seat: {
    section: 'A',
    seatNumber: '001-0100',
  },
}
```

### **Create Payment Intent**

Create payment intent powered by Stripe to get URL to payment page. While the payment session is still active (it's neither succeed or failed), the ordered seat status will not be available for other session. User will be given 15 minutes to complete the order, else it will be canceled automatically.

### Endpoint

```
POST /api/ticket/create-payment-intent
```

### Parameters

_No parameters._

### Body Data

Type: JSON

- `total` **Required**  
  Type: `Number`  
  Default: 0  
  Ticket checkout total price.
- `seat` **Required**  
  Type: `Object`  
  Default: 0  
  Seat information.
  - `section` **Required**  
    Type: String  
    Default: ''  
    Seat section.
  - `number` **Required**  
    Type: String  
    Default: ''  
    Seat number.

### Returns

Redirect URL to Stripe checkout page.

### Response Example

```js
{
  url: 'http://stripe.com/checkout' // URL will be generated by Stripe.
},
```

---

## Transaction

Transaction data to monitor all initiated checkouts, its status, and act as a general log book.

### Data Structure

```js
{
  _id: String,
  transactionId: String, // Stripe payment session ID.
  fixture: Object,
  seat: Object,
  status: Array, // An array of statuses. The last entry will be the latest update.
}
```

#### Example:

```js
{
  _id: 'abcdefghijkl',
  fixture: 'mnopqrstuvwxyz',
  seat: {
    section: 'A',
    seatNumber: '001-0100',
  },
  status: [
    'Payment intent created.',
    'Payment is pending.',
    'Payment has completed.',
  ],
}
```

---

## User Management

User accounts management using Passport local strategy (username and password) and maintains login state as sessions.

### **Register**

Register new user.

### Endpoint

```
POST /api/user/register
```

### Parameters

No parameters.

### Body Data

Type: JSON

- `username` **Required**  
  Type: `String`  
  Default: ''  
  User's username. Used as one of the login credentials.
- `password` **Required**  
  Type: `String`  
  Default: ''  
  User's password.
- `email` **Required**  
  Type: String  
  Default: ''  
  User's email.

### Returns

None.
